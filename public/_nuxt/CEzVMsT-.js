const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./I4QTSg87.js","./DKjhEE28.js","./entry.0JhiI90_.css","./iGWGNsSM.js"])))=>i.map(i=>d[i]);
import{av as L,am as U,aw as x,_ as R}from"./DKjhEE28.js";import{t as k}from"./iGWGNsSM.js";const w=(i,s)=>{const e=i._conditions;return e.length>0?`(${e.join(` ${s} `)})`:""},I=i=>{const s=[],e={_conditions:s,where(n,r,t){let a;switch(r.toUpperCase()){case"IN":case"NOT IN":if(Array.isArray(t)){const u=t.map(h=>$(h)).join(", ");a=`"${String(n)}" ${r.toUpperCase()} (${u})`}else throw new TypeError(`Value for ${r} must be an array`);break;case"BETWEEN":case"NOT BETWEEN":if(Array.isArray(t)&&t.length===2)a=`"${String(n)}" ${r.toUpperCase()} ${$(t[0])} AND ${$(t[1])}`;else throw new Error(`Value for ${r} must be an array with two elements`);break;case"IS NULL":case"IS NOT NULL":a=`"${String(n)}" ${r.toUpperCase()}`;break;case"LIKE":case"NOT LIKE":a=`"${String(n)}" ${r.toUpperCase()} ${$(t)}`;break;default:a=`"${String(n)}" ${r} ${$(typeof t=="boolean"?Number(t):t)}`}return s.push(`${a}`),e},andWhere(n){const r=n(I());return s.push(w(r,"AND")),e},orWhere(n){const r=n(I());return s.push(w(r,"OR")),e}};return e},B=(i,s)=>{const e={conditions:[],selectedFields:[],offset:0,limit:0,orderBy:[],count:{field:"",distinct:!1}},n={__params:e,andWhere(t){const a=t(I());return e.conditions.push(w(a,"AND")),n},orWhere(t){const a=t(I());return e.conditions.push(w(a,"OR")),n},path(t){return n.where("path","=",L(t))},skip(t){return e.offset=t,n},where(t,a,u){return n.andWhere(h=>h.where(String(t),a,u)),n},limit(t){return e.limit=t,n},select(...t){return t.length&&e.selectedFields.push(...t),n},order(t,a){return e.orderBy.push(`"${String(t)}" ${a}`),n},async all(){return s(i,r()).then(t=>t||[])},async first(){return s(i,r({limit:1})).then(t=>t[0]||null)},async count(t="*",a=!1){return s(i,r({count:{field:String(t),distinct:a}})).then(u=>u[0].count)}};function r(t={}){let a="SELECT ";if(t!=null&&t.count)a+=`COUNT(${t.count.distinct?"DISTINCT ":""}${t.count.field}) as count`;else{const h=Array.from(new Set(e.selectedFields));a+=h.length>0?h.map(f=>`"${String(f)}"`).join(", "):"*"}a+=` FROM ${k[String(i)]}`,e.conditions.length>0&&(a+=` WHERE ${e.conditions.join(" AND ")}`),e.orderBy.length>0?a+=` ORDER BY ${e.orderBy.join(", ")}`:a+=" ORDER BY stem ASC";const u=(t==null?void 0:t.limit)||e.limit;return u>0&&(e.offset>0?a+=` LIMIT ${u} OFFSET ${e.offset}`:a+=` LIMIT ${u}`),a}return n};function $(i){return`'${String(i).replace(/'/g,"''")}'`}function W(i){return s=>(s=s||{},(i||[]).filter(e=>typeof s[e]<"u").reduce((e,n)=>Object.assign(e,{[n]:s[n]}),{}))}async function P(i,s=[]){var f;const e=i.__params;(f=e==null?void 0:e.orderBy)!=null&&f.length||(i=i.order("stem","ASC"));const n=await i.orWhere(o=>o.where("navigation","<>","false").where("navigation","IS NULL")).select("navigation","stem","path","title","meta",...s||[]).all(),{contents:r,configs:t}=n.reduce((o,c)=>{var g;if(String(c.stem).split("/").pop()===".navigation"){c.title=((g=c.title)==null?void 0:g.toLowerCase())==="navigation"?"":c.title;const y=c.path.split("/").slice(0,-1).join("/")||"/";o.configs[y]={...c,...c.body}}else o.contents.push(c);return o},{configs:{},contents:[]}),a=o=>({...W(["title",...s])(o),...o.meta,..._(o==null?void 0:o.navigation)?o.navigation:{}}),u=o=>({...W(["title",...s])(o),..._(o==null?void 0:o.navigation)?o.navigation:{}}),h=r.reduce((o,c)=>{var C;const g=c.path.substring(1).split("/"),y=c.stem.split("/"),E=!!((C=y[y.length-1])!=null&&C.match(/([1-9]\d*\.)?index/g)),O=l=>({title:l.title,path:l.path,stem:l.stem,children:[],...u(l)}),d=O(c);if(E){const l=t[d.path];if(typeof(l==null?void 0:l.navigation)<"u"&&(l==null?void 0:l.navigation)===!1)return o;if(c.path!=="/"){const p=O(c);d.children.push(p)}l&&Object.assign(d,a(l))}if(g.length===1){const l=o.find(p=>p.path===d.path&&p.page===!1);return E&&l?Object.assign(l,{page:void 0,children:[...d.children||[],...l.children||[]]}):o.push(d),o}const T=g.slice(0,-1).reduce((l,p,A)=>{const v="/"+g.slice(0,A+1).join("/"),m=t[v];if(typeof(m==null?void 0:m.navigation)<"u"&&m.navigation===!1)return[];let S=l.find(b=>b.path===v);if(!S){const b=m?a(m):{};S={...b,title:b.title||q(p),path:v,stem:y.slice(0,A+1).join("/"),children:[],page:!1},l.push(S)}return S.children},o),N=T.find(l=>l.path===d.path&&l.page===!1);return N?Object.assign(N,{...d,page:void 0,children:[...d.children||[],...N.children||[]]}):T.push(d),o},[]);return j(h)}function j(i){var e;const s=i;for(const n of s)(e=n.children)!=null&&e.length?j(n.children):delete n.children;return i}function _(i){return i!==null&&Object.prototype.toString.call(i)==="[object Object]"}const q=i=>i.split(/[\s-]/g).map(U).join(" ");async function F(i,s,e){const{before:n=1,after:r=1,fields:t=[]}=e||{},a=await P(i,t),u=D(a),h=u.findIndex(c=>c.path===s),f=h===-1?[]:u.slice(h-n,h),o=h===-1?[]:u.slice(h+1,h+r+1);return[...Array.from({length:n}).fill(null).concat(f).slice(f.length),...o.concat(Array.from({length:r}).fill(null)).slice(0,r)]}function D(i){return i.flatMap(e=>{const n=e.children?D(e.children):[];return e.page===!1||n.length&&n.find(r=>r.path===e.path)?n:[{...e,children:void 0},...n]})}const Q=i=>{var e,n;const s=(n=(e=x())==null?void 0:e.ssrContext)==null?void 0:n.event;return B(i,(r,t)=>M(s,r,t))};function H(i,s,e){return G(i,n=>F(n,s,e))}async function M(i,s,e){return V(s,e)}async function V(i,s){return await R(()=>import("./I4QTSg87.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(n=>n.loadDatabaseAdapter(i)).then(n=>n.all(s))}function G(i,s){const e=Q(i),n={where(r,t,a){return e.where(String(r),t,a),n},andWhere(r){return e.andWhere(r),n},orWhere(r){return e.orWhere(r),n},order(r,t){return e.order(String(r),t),n},then(r,t){return s(e).then(r,t)},catch(r){return this.then(void 0,r)},finally(r){return this.then(void 0,void 0).finally(r)},get[Symbol.toStringTag](){return"Promise"}};return n}export{H as a,Q as q};
